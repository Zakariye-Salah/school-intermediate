<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin â€” School</title>
<!-- admin-mobile-styles -->
<style>
  :root{
    --bg:#f8fafc; --card:#fff; --muted:#6b7280; --primary:#0ea5e9; --danger:#ef4444; --radius:12px;
  }
  /* page */
  body{ margin:0; padding:18px; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:#0f172a; -webkit-font-smoothing:antialiased }
  header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px }
  .brand{ font-weight:800; font-size:18px }
  /* swipeable tabs */
  .tabs{ display:flex; gap:8px; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px; scrollbar-width:none; }
  .tabs::-webkit-scrollbar{ display:none; }
  .tab{ flex:0 0 auto; padding:8px 12px; border-radius:12px; background:#e6eef8; border:none; cursor:pointer; font-weight:800; white-space:nowrap }
  .tab.active{ background:var(--primary); color:#fff; box-shadow:0 8px 22px rgba(11,116,255,0.12) }

  main{ margin-top:8px }
  .page{ display:none; background:var(--card); padding:12px; border-radius:var(--radius); box-shadow:0 8px 28px rgba(2,6,23,0.04) }
  .page.active{ display:block }

  .page-header{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:12px }
  .page-header input, .page-header select { padding:8px 10px; border-radius:8px; border:1px solid #e6eef8; min-width:120px }
  .btn{ padding:8px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:800 }
  .btn-primary{ background:var(--primary); color:#fff }
  .btn-ghost{ background:#f3f4f6 }

  /* compact mobile row */
  .list-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; background:linear-gradient(180deg,#fff,#fbfdff);
    padding:10px; border-radius:10px; margin-bottom:10px; border:1px solid rgba(2,6,23,0.03); box-shadow:0 6px 18px rgba(2,6,23,0.03) }
  .row-left{ display:flex; gap:10px; align-items:center; min-width:0 }
  .no-badge{ min-width:36px; text-align:center; font-weight:900; color:var(--muted) }
  .id{ font-family:monospace; font-weight:800; min-width:86px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .title{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:220px }
  .sub{ color:var(--muted); font-weight:700; font-size:0.92rem }
  .more-btn{ background:transparent; border:1px solid rgba(2,6,23,0.06); padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:900 }

  /* desktop: keep table display (hide mobile rows) */
  @media(min-width:821px){
    .list-row{ display:none; }
    table.admin-table{ width:100%; border-collapse:collapse; }
    table.admin-table th, table.admin-table td { padding:10px; border-bottom:1px solid #eef2f9; text-align:left }
  }

  /* modal */
  #modalBackdrop{ position:fixed; inset:0; display:none; align-items:flex-end; justify-content:center; background:rgba(2,6,23,0.45); z-index:60; padding:12px; }
  #modal{ background:#fff; padding:14px; border-radius:12px; width:100%; max-width:920px; box-shadow:0 16px 48px rgba(2,6,23,0.35); position:relative }
  #modalTitle{ font-weight:800; margin-bottom:8px }
  #modalBody{ max-height:68vh; overflow:auto }
  #modalClose{ position:absolute; right:12px; top:12px; background:var(--danger); color:#fff; border-radius:8px; padding:6px; border:none; cursor:pointer }
  .modal-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; flex-wrap:wrap }
  .muted{ color:var(--muted) }
  .pill{ display:inline-block; padding:4px 8px; border-radius:999px; background:#f1f5f9; font-weight:800; color:var(--muted); font-size:.85rem }

  /* --------- Payments UI tweaks (mobile two-row header, colors, loader) --------- */

/* container row splitting for payments header */
.page-header {
  gap: 8px;
}
.page-header .ph-row { display:flex; gap:8px; align-items:center; width:100%; }
.page-header .ph-left { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.page-header .ph-right { display:flex; gap:8px; align-items:center; margin-left:auto; flex-wrap:wrap; }

/* small screens: stack into two lines */
@media (max-width:720px){
  .page-header { flex-direction:column; align-items:stretch; gap:6px; }
  .page-header .ph-row { justify-content:space-between; }
  /* make search consume single row */
  #paymentsSearch { flex:1; min-width: 0; }
  /* second row holds filters & export (wrap if needed) */
  #paymentsClassFilter, #paymentsStatusFilter, #paymentsTeacherSubjectFilter {
    min-width: 120px; max-width: 45%;
  }
  #paymentsExport { order: 99; margin-left:auto; }
}

/* colors for fee / balance / class */
.fee-blue { color:#246bff; font-weight:900; }
.balance-red { color:#ef4444; font-weight:900; }
.class-blue { color:#0b74ff; font-weight:900; }

/* 3-dot loader used inside buttons */
.btn-loader { display:inline-flex; gap:6px; align-items:center; padding-left:4px; padding-right:4px; }
.btn-loader span { width:6px; height:6px; border-radius:50%; background:rgba(255,255,255,0.95); display:inline-block; opacity:0.95; transform:translateY(0); animation: btn-dot 900ms infinite; }
.btn-loader span:nth-child(2){ animation-delay:120ms; background:rgba(255,255,255,0.9); }
.btn-loader span:nth-child(3){ animation-delay:240ms; background:rgba(255,255,255,0.85); }
@keyframes btn-dot { 0%{ transform:translateY(0); opacity:0.35 } 50%{ transform:translateY(-6px); opacity:1 } 100%{ transform:translateY(0); opacity:0.35 } }

/* small styling for "more" modal content (mobile) */
.modal-more-grid { display:grid; grid-template-columns:1fr; gap:8px; }
.modal-more-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }

/* small icon wrappers to keep inline SVGs tidy */
.icon-sm { width:18px; height:18px; display:inline-block; vertical-align:middle; }

/* export logo smaller in export render */
@media print {
  img[export-logo] { max-height: 36px; }
}
/* make sure ID block doesn't force a gap when absent; allow id button to shrink/break */
.payments-card .id-block { flex: 0 0 auto; min-width:0; }
.payments-card .payments-id-btn { min-width:0; word-break:break-all; text-align:left; }
.payments-card .id-block.hidden { display:none; }

/* charts: enforce stable height so Chart.js does not expand endlessly */
.card canvas {
  width: 100% !important;
  height: 220px !important;
  display: block;
}
.card.chart-card { min-height: 260px; }

.mobile-top10-header{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:12px;
}

.mobile-top10-header .h-title{
  font-weight:900;
  font-size:1.05rem;
}

.mobile-top10-header .h-sub{
  font-size:0.85rem;
  color:#6b7280;
}

.mobile-top10-header .h-row input{
  width:100%;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #e5e7eb;
}

.mobile-top10-header .h-actions{
  display:flex;
  gap:8px;
}


/* ===============================
   Mobile Top-10 Header Fix
   =============================== */
   @media (max-width: 768px) {

.mobile-top10-header {
  padding: 12px;
  border-bottom: 1px solid #eef2f9;
}

.mobile-top10-header .h-title {
  font-size: 1rem;
  font-weight: 900;
  margin-bottom: 2px;
}

.mobile-top10-header .h-sub {
  font-size: 0.82rem;
  color: #6b7280;
  line-height: 1.2;
}

/* ðŸ” Search row */
.mobile-top10-header .h-row {
  margin-top: 8px;
}

.mobile-top10-header input[type="search"] {
  width: 100%;
  max-width: 100%;
  padding: 10px;
  font-size: 0.9rem;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
}

/* ðŸŽ¯ Action buttons row */
.mobile-top10-header .h-actions {
  margin-top: 8px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.mobile-top10-header .h-actions .btn {
  flex: 1 1 48%;
  padding: 8px 10px;
  font-size: 0.85rem;
  border-radius: 10px;
  text-align: center;
}

/* ===============================
   List rows action buttons
   =============================== */

.list-row {
  padding: 10px;
  gap: 10px;
}

.list-row .row-left {
  min-width: 0;
}

.list-row .title {
  font-size: 0.95rem;
  font-weight: 900;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.list-row .sub {
  font-size: 0.78rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ðŸ‘ï¸ Pay / View buttons */
.list-row .btn {
  padding: 6px 8px;
  min-width: 40px;
  height: 36px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
}

}
/* Hide desktop-only headers on mobile */
@media (max-width: 768px) {

/* Outstanding desktop header */
#outstandingCard > div:first-child {
  display: none !important;
}

/* Leaderboard desktop header */
#leaderboardCard > div:first-child {
  display: none !important;
}

}


</style>

</head>
<body>
  <header>
    <div class="brand">Admin â€” School System</div>
    <div>
      <button id="btnLogout" class="btn btn-ghost">Logout</button>
    </div>
  </header>

  <nav class="tabs" role="navigation" aria-label="Admin pages">
    <button id="tabStudents" class="tab active">Students</button>
    <button id="tabClasses" class="tab">Classes</button>
    <button id="tabSubjects" class="tab">Subjects</button>
    <button id="tabExams" class="tab">Exams</button>
    <button id="tabTeachers" class="tab">Teachers</button>
    <!-- somewhere in header or nav buttons -->
<button id="gotoLeaderboardBtn" class="btn">Leaderboard</button>

  </nav>

  <!-- PAGES -->
  <main>
    <section id="pageStudents" class="page" style="display:block">
      <div class="page-header">
        <input id="studentsSearch" type="text" placeholder="Search students..." />
        <select id="studentsClassFilter"></select>
        <select id="studentsExamForTotals"></select>
        <button id="openAddStudent" class="btn btn-primary">+ Add Student</button>
      </div>
      <div id="studentsList"></div>
    </section>

    <section id="pageClasses" class="page">
      <div class="page-header">
        <input id="classSearch" type="text" placeholder="Search classes..." />
        <button id="openAddClass" class="btn btn-primary">+ Add Class</button>
      </div>
      <div id="classesList"></div>
    </section>

    <section id="pageSubjects" class="page">
      <div class="page-header">
        <input id="subjectSearch" type="text" placeholder="Search subjects..." />
        <button id="openAddSubject" class="btn btn-primary">+ Add Subject</button>
      </div>
      <div id="subjectsList"></div>
    </section>

    <section id="pageExams" class="page">
      <div class="page-header">
        <input id="examSearch" type="text" placeholder="Search exams..." />
        <select id="examClassFilter"></select>
        <button id="openAddExam" class="btn btn-primary">+ Add Exam</button>
      </div>
      <div id="examsList"></div>
    </section>

    <section id="pageTeachers" class="page">
      <div class="page-header">
        <input id="teachersSearch" type="text" placeholder="Search teachers..." />
        <select id="teachersSubjectFilter"></select>
        <button id="openAddTeacher" class="btn btn-primary">+ Add Teacher</button>
      </div>
      <div id="teachersList"></div>
    </section>
  </main>

  <!-- Modal (shared) -->
  <div id="modalBackdrop">
    <div id="modal">
      <button id="modalClose">âœ•</button>
      <h3 id="modalTitle"></h3>
      <div id="modalBody"></div>
    </div>
  </div>

  <div id="toast"></div>

  <!-- Add these BEFORE database.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<!-- Chart.js (for charts) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Ensure html2canvas, jspdf, etc. are loaded already (you already included them). -->
<!-- Then load firebase-config.js and database.js (your existing scripts). -->

<!-- After database.js loads, ensure the dashboard opens on page load -->
<script>
  // If renderDashboard is exported globally in database.js, call it on page load.
  // Wait a tick to let your module load caches; adjust if your init flow differs.
  window.addEventListener('load', () => {
    try {
      // show dashboard page and call renderDashboard
      if (typeof renderDashboard === 'function') {
        renderDashboard({ defaultFilter: 'This Month' }).catch(err => console.error('renderDashboard failed', err));
      } else {
        // if module exports differently, try a short delay
        setTimeout(() => {
          if (typeof renderDashboard === 'function') renderDashboard({ defaultFilter: 'This Month' });
        }, 400);
      }
    } catch (e) { console.error(e); }
  });
</script>

  <!-- Firebase config + app logic -->
  <!-- Make sure database.js path is correct and it's type=module -->
  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="database.js"></script>
</body>
</html>
